<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme=""
  class="html"
><head>
  <title>
    Liwei Xu
        |
        聊聊 Base64 编码


      


    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.102.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="Liwei Xu" />
  <meta
    name="description"
    content=""
  />
  
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.b2e0cb07595e3519ab1193bb421914e06c0e26b0cc561fef23b3c6131d4d2ffa.css"
      integrity="sha256-suDLB1leNRmrEZO7QhkU4GwOJrDMVh/vI7PGEx1NL/o="
      crossorigin="anonymous"
      type="text/css"
    />

  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css"
    integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7f3c2281c7f965ce3c64888aa452793252a0416909c181097f81d0a0f7d1624e.css"
    integrity="sha256-fzwigcf5Zc48ZIiKpFJ5MlKgQWkJwYEJf4HQoPfRYk4="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.35fc032da8ede6681675d20a2f862fb9e1045c1d512d495fcf862c054daffef2.css"
    integrity="sha256-NfwDLajt5mgWddIKL4YvueEEXB1RLUlfz4YsBU2v/vI="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.3b92357925ea7284f0c6b0378396f39f470f7842ed9702f337e667c4026bf837.css"
    integrity="sha256-O5I1eSXqcoTwxrA3g5bzn0cPeELtlwLzN&#43;ZnxAJr&#43;Dc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.ebb1096e1976e8cc4e2532cfa050b8f30eb13b8eb06be5cee3e38eb426b838ea.css"
    integrity="sha256-67EJbhl26MxOJTLPoFC48w6xO46wa&#43;XO4&#43;OOtCa4OOo="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

  <link rel="canonical" href="https://xuliwei.xzy/posts/base64/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js"
    integrity="sha256-&#43;RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.738c0e3a493854876aeab9e2316fd43f1936aeeac4cc6b3e60bb26456dba72ad.js"
      integrity="sha256-c4wOOkk4VIdq6rniMW/UPxk2rurEzGs&#43;YLsmRW26cq0="
      crossorigin="anonymous"
    ></script>

  

  


  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="聊聊 Base64 编码"/>
<meta name="twitter:description" content="Base64 编码是日常的编程中经常用到的编码方案之一，尤其是在传输信息的时候。有些初学者搞不清楚它和普通字符串的区别，也有些初学者把它和文本加密混淆。这里对 Base64 编码做一个详细的介绍。 可打印字符和控制字符 介绍 Base64 编码之前，先介绍下什么是可打印字符。可打印字"/>



  
  <meta property="og:title" content="聊聊 Base64 编码" />
<meta property="og:description" content="Base64 编码是日常的编程中经常用到的编码方案之一，尤其是在传输信息的时候。有些初学者搞不清楚它和普通字符串的区别，也有些初学者把它和文本加密混淆。这里对 Base64 编码做一个详细的介绍。 可打印字符和控制字符 介绍 Base64 编码之前，先介绍下什么是可打印字符。可打印字" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xuliwei.xzy/posts/base64/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-16T15:36:21+08:00" />
<meta property="article:modified_time" content="2019-04-16T15:36:21+08:00" /><meta property="og:site_name" content="只言片语" />




  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "posts",
        "name": "聊聊 Base64 编码",
        "headline": "聊聊 Base64 编码",
        "alternativeHeadline": "",
        "description": "
      
        Base64 编码是日常的编程中经常用到的编码方案之一，尤其是在传输信息的时候。有些初学者搞不清楚它和普通字符串的区别，也有些初学者把它和文本加密混淆。这里对 Base64 编码做一个详细的介绍。 可打印字符和控制字符 介绍 Base64 编码之前，先介绍下什么是可打印字符。可打印字


      


    ",
        "inLanguage": "en-us",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/xuliwei.xzy\/posts\/base64\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Liwei Xu"
        },
        "creator" : {
            "@type": "Person",
            "name": "Liwei Xu"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Liwei Xu"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Liwei Xu"
        },
        "copyrightYear" : "2019",
        "dateCreated": "2019-04-16T15:36:21.00Z",
        "datePublished": "2019-04-16T15:36:21.00Z",
        "dateModified": "2019-04-16T15:36:21.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Liwei Xu",
            "url": "https://xuliwei.xzy",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/xuliwei.xzyfavicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
      ]

    ,
        "url" : "https:\/\/xuliwei.xzy\/posts\/base64\/",
        "wordCount" : "2418",
        "genre" : [ ],
        "keywords" : [ ]
    }
  </script>



</head>
<body
    
      class="body theme--light"

    
  >
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"

        
      ><div
  class="sidebar
    animated fadeInDown

  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="/images/profile.jpg"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/">只言片语</a>
        </div>

      
      <div class="sidebar__introduction-description">
        <p></p>
      </div>
    </div>
    <ul class="sidebar__list">
      
    </ul>
  </div><footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Liwei Xu
        2022


      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main
        
          class="wrapper__main"

        
      >
        <header class="header"><div
  class="
    animated fadeInDown

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
        
        
          <li class="nav__list-item">
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>

        


      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
        <li class="nav__list-item">
          <div class="themeswitch">
            <a title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </div>
        </li>

      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown

    "
  >
    
    <div class="post__content">
      <h1>聊聊 Base64 编码</h1>
      <p>Base64 编码是日常的编程中经常用到的编码方案之一，尤其是在传输信息的时候。有些初学者搞不清楚它和普通字符串的区别，也有些初学者把它和文本加密混淆。这里对 Base64 编码做一个详细的介绍。</p>
<h2 id="可打印字符和控制字符">可打印字符和控制字符</h2>
<p>介绍 Base64 编码之前，先介绍下什么是可打印字符。可打印字符（printable character）也称为图形字符（graphic character），指的是在 ASCII 以及类似的标准中，可以打印或展示出来给人读的字符。标准的 ASCII 码有7位用来编码，可表示128个字符，其中只有序号32-126的是可打印字符，比如 <code>a-z</code>、<code>A-Z</code>、<code>0-9</code> 和一些标点符号等。其他字符称为控制字符（control characters），它们的作用是不是用来展示信息，而是用来控制设备的。</p>
<h2 id="base64-是一组编码方案">Base64 是一组编码方案</h2>
<p>Base64 是一组相似的从二进制到文本的编码方案，它使用一个基于64个可打印字符的表示方式，将二进制数据表示成 ASCII 字符串（即用 ASCII 码中的64个可打印字符组成的字符串）的形式。每个 Base64 的字符表示一个6位的二进制（2^6=64），由于平时计算机里的储存的数据都是按一个字节8位来表示的，所以4个 Base64 的字符恰好能表示3个字节的二进制数据，这样一来，像图片等非文本文件的数据就可以用文本来表示了。</p>
<h2 id="为什么要有-base64-编码方案">为什么要有 Base64 编码方案</h2>
<p>首先回答的是，为什么需要一个从二进制到文本的编码方案？这是因为有些协议（比如 HTTP 和邮件传输协议）是用纯文本而不是二进制数据进行数据传输的，如果内容本身就是文本没有问题，如果内容是图片、音频或视频等二进制文件，就需要先转码再传输了。</p>
<p>接下来的问题是，为什么不直接用 ASCII 码？这是因为标准 ASCII 使用的位数是7位，并不是恰好8位的，因此如果直接编码，值在128到255之间的二进制值在标准 ASCII 码里没有对应的字符。同时，由于 ASCII 码中有33个是控制字符，而早期的网络协议中是不能传输这些控制字符的。</p>
<p>因此，就需要一个可以将二进制数据转换成可打印字符的专门的编码方式，Base64 编码最早就是起源于 <a href="https://en.wikipedia.org/wiki/MIME#Content-Transfer-Encoding">MIME 的内容传输编码方法</a></p>
<h2 id="base64-介绍">Base64 介绍</h2>
<p>上面已经介绍了 Base64 编码是什么以及为什么会有 Base64 编码，下面就来介绍下一些细节部分。首先先看 MIME 版本的 Base64 编码，它的二进制值和字符的对应关系如下：</p>
<p><img src="https://raw.githubusercontent.com/LeewayHsu/leewayhsu.github.io/master/images/base64_1.png" alt=""></p>
<p>可以看到前62个字符就是大小写字母和数字，剩下两个是 <code>+</code> 和 <code>/</code>，这两个符号也是不同的 Base64 编码方案区别所在，比如<a href="https://tools.ietf.org/html/rfc4648#section-5">用于 URL 编码的 Base64 方案</a> 就是 <code>-</code> 和 <code>_</code>，这是因为标准的 Base64 并不适合直接放在 URL 里传输，因为 URL 编码器会把标准 Base64 中的 <code>/</code> 和 <code>+</code> 字符变为形如 <code>%XX</code> 的形式，而这些 <code>%</code> 号在存入数据库时还需要再进行转换，因为 ANSI SQL 中已将 <code>%</code> 号用作通配符。</p>
<p>举个维基百科上的例子，Man 这个单词，M、a、n 对应的 ASCII 码分别是77、97和110，而这三个数字在计算机中存储的二进制是 01001101、01100001 和 01101110。接下来把三个字节共24位分成4组，每组6位，即010011、010110、000101和101110，并转换成10进制就是19、22、5 和 46，最后再去上面的编码表中找到对应的字符 T、W、F 和 u。那么 Man 的 Base64 编码后的结果就是 TWFu：</p>
<p><img src="https://raw.githubusercontent.com/LeewayHsu/leewayhsu.github.io/master/images/base64_2.png" alt=""></p>
<p>这是一个恰好可以按6位分组的例子，那么不足的情况呢？不足的情况有两种，一种是多一个字节，一种是多两个字节（多三个字节就被整除啦）。这种情况首先在后面补足0到24位，接下来，6个全时0的字节为1个 <code>=</code>，这样多一个字节的就补充量个 <code>=</code>，多两个字节的就补充一个 <code>=</code>。可以看下图的例子，很清晰：</p>
<p><img src="https://raw.githubusercontent.com/LeewayHsu/leewayhsu.github.io/master/images/base64_3.png" alt=""></p>
<p>理论上，解码的时候不需要 padding character（即这里的 <code>=</code>），因为可以算出来丢失的字节数。按每四个字符对应三个字节来解码后，会剩余两到三个字符（一个字符不可能，因为一个字符才6位，当时编码时8位字节取前6位后肯定有剩余），看情况补0就好。所以有些 Base64 的实现中是强制加上 padding characher 有些不是。</p>
<p>如上面所述，Base64 编码的实现方式的主要区别就在于最后两个字符的选择和时候加 padding character，具体的实现方式可以参考<a href="https://en.wikipedia.org/wiki/Base64#Variants_summary_table">这里</a>。这里说下 Base64 在 URL 上的编码实现，因为这在日常工作中很常见。由于 <a href="https://en.wikipedia.org/wiki/Percent-encoding">URL 编码机制</a>里会对一些特殊字符做替换，比如 <code>+</code> 替换成 <code>%2B</code>，<code>/</code> 替换成 <code>%2F</code>，以及 <code>=</code> 替换成 <code>%3D</code>，所以在 URL 的处理上最后两个字符是 <code>-</code> 和 <code>_</code>，而 <code>=</code> 是否换成其他符号还是省略就看具体的类库了，如果用来分隔两个 Base64 字符串就留着并用其他字符替代比如 <code>.</code>，如果不用就可以省略。</p>
<h2 id="data-uri-中-base64-的应用">Data URI 中 Base64 的应用</h2>
<p>一般 HTML 文档中，<code>&lt;img /&gt;</code> 标签都是引用的外部文件，比如 <code>&lt;img src='http://imgcdn.domain.com/hello.jpg' /&gt;</code> 这样的形式。这样是符合 HTML 标准的做法，但是在有些场景下，如果能够把图片直接嵌在文档中就更好了，比如一个页面有大量的很小的图片，如果都在加载的时候去服务器取的话加载速度会编码。这时候就可以用 Data URI 的方案了，它允许将图片内嵌在文档中，使用的正是 Base64 编码可以将二进制文件转换成文本的功能。</p>
<p>Data URI 不光可以用于图片，还能用在其他文件标签上，格式的标准方式是：<code>data:[&lt;media type&gt;][;base64],&lt;data&gt;</code>。举个例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Red dot&#34;</span> /&gt;
</span></span></code></pre></div><p>此时，大部分浏览器都会将 Base64 编码的文本转换成图片渲染在 <code>&lt;img /&gt;</code> 标签的位置。</p>
<p>用 Data URI 来存储图片的场景除了上面说的图片很小的之外，还有个很重要的就是 HTML5 页面用在手机拍照上传的时候，此时手机拍的照片不需要存在别的地方等待上传，而是直接编码成 Base64 的格式存在标签上。</p>
<p>当然 Data URI 形式也有劣势，除了编码后体积大外，还有个重要的缺陷就是浏览器不能缓存，所以如果被访问的比较频繁的页面上图片还是用地址引用的形式比较好。</p>
<h2 id="base64-编码不能用来加密">Base64 编码不能用来加密</h2>
<p>初学者经常犯的一个错误就是认为 Base64 可以用来加密，这是个错误的观点。Base64 没有密钥，任何一个 Base64 编码后的字符串都可以轻松还原成初始文本。如果要可逆的加密，还是要去使用 DES、AES 以及 RSA 等算法，如果要不可逆的摘要，就去使用 MD5 和 SHA256 等算法。Base64 和 ASCII 码的区别在于，ASCII 码的目的是为了用二进制存储在表示文本，而 Base64 则是为了用文本来表示二进制存储，二者的目的是恰恰相反的。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Base64">Base64 - Wikipedia</a></li>
<li><a href="https://stackoverflow.com/questions/3538021/why-do-we-use-base64/3538079#3538079">algorithm - Why do we use Base64? - Stack Overflow</a></li>
<li><a href="https://stackoverflow.com/questions/201479/what-is-base-64-encoding-used-for/201510#201510">base64 - What is base 64 encoding used for? - Stack Overflow</a></li>
</ul>
</div>
    <div class="post__footer">
      

      
    </div>

    
  </div>


      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Liwei Xu
        2022


      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></body>
</html>
